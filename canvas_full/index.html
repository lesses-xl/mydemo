<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>canvas</title>
</head>
<body>
	<canvas id="canvas"></canvas>

	<script type="text/javascript">

		var once = null;
		once = setTimeout(changeScreen(),50);
		function changeScreen() {
				//定义一个定时器
				var timer = null;

				var w = window.innerWidth;
				var h = window.innerHeight;

				//获取到canvas
				var canvas = document.getElementById('canvas');

				//获取到canvas上下文
				var ctx = canvas.getContext('2d');

				//设置高度，宽度
				canvas.width =  w;
				canvas.height =  h;

				//设置线宽
				ctx.lineWidth = 0.3;


				//设置描绘的颜色
				//个人认为，这个150可加可不加，并没有什么影响
				ctx.strokeStyle = (new Color(150)).style; 


				//设置点与点之间进行线条连接的起始位置
				var mousePosition = {
					x: 50 * canvas.width / 100,
					y: 50 * canvas.height / 100
				};

				//定义画布上的点
				var dots = {
					num : 200,  //数量
					distance: 100,  //每个点要连线的距离
					d_radius: 150,  //这个点本身的半径  连接范围
					array: []
				}


				//定义颜色的RGB范围
				function colorValue(min) {
					return Math.floor(Math.random() * 255 + min);
				};

				//定义颜色为RBGA类型
				function createColorStyle(r,g,b) {
					return 'rgba(' + r + ',' + g + ',' + b + ',0.9)'; 
				}

				//
				function mixComponents(comp1,weight1,comp2,weight2) {
					return (comp1 * weight1 + comp2 * weight2) / (weight1 + weight2);
				}

				//定义两个点之间线条的颜色
				function averageColorStyles(dot1,dot2) {
					var color1 = dot1.color;
					var color2 = dot2.color;

					//
					var r = mixComponents(color1.r, dot1.radius, color2.r, dot2.radius);
					var g = mixComponents(color1.g, dot1.radius, color2.g, dot2.radius);
					var b = mixComponents(color1.b, dot1.radius, color2.b, dot2.radius);

					return createColorStyle(Math.floor(r), Math.floor(g), Math.floor(b));
				}

				// 创建颜色对象
				function Color(min) {
					min = min || 0;
					this.r = colorValue(min);
					this.g = colorValue(min);
					this.b = colorValue(min);
					this.style = createColorStyle(this.r, this.g, this.b);
				}

				// 创建点
				function Dot() {

					//得到x,y位于这个画布的起始坐标
					this.x = Math.random() * canvas.width; 
					this.y = Math.random() * canvas.height;

					this.vx = -0.5 * Math.random();
					this.vy = -0.5 * Math.random();

					this.radius = Math.random() * 2;

					this.color = new Color();
				}

				//添加原型
				Dot.prototype = {
					draw: function(){

						//开始
						ctx.beginPath();  

						//设置填充颜色
						ctx.fillStyle = this.color.style;  

						//设置圆的x坐标，y坐标，半径，起始位置，结束位置
						ctx.arc(this.x,this.y,this.radius,0,Math.PI * 2);

						//填充颜色，完成圆的绘制
						ctx.fill();
					}
				};

				//创建点的数量
				function createDots() {
					// 根据之前定义的点的数量，通过上面的代码，创建这个数量的点，添加到这个数组中
					for(let i=0; i<dots.num; i++){
						dots.array.push(new Dot())
					};
				};

				//点的移动
				function moveDots() {
					for(let i=0; i<dots.num; i++){
						var dot = dots.array[i];

						if(dot.y < 0 || dot.y > canvas.height) {
							dot.vx = dot.vx;
							dot.vy = - dot.vy;
						}
						else if(dot.x < 0 || dot.x > canvas.width){
							dot.vx = - dot.vx;
							dot.vy = dot.vy;
						}
						dot.x += dot.vx;
						dot.y += dot.vy;
					}
				}

				//点的连接
				function connectDots() {
					for(let i=0; i<dots.num; i++){
						for(let j=0; j<dots.num; j++){
							i_dot = dots.array[i];
							j_dot = dots.array[j];

							if((i_dot.x - j_dot.x) < dots.distance && (i_dot.y - j_dot.y) < dots.distance && (i_dot.x - j_dot.x) > - dots.distance && (i_dot.y - j_dot.y) > - dots.distance){
								if((i_dot.x - mousePosition.x) < dots.d_radius && (i_dot.y - mousePosition.y) < dots.d_radius && (i_dot.x - mousePosition.x) > - dots.d_radius && (i_dot.y - mousePosition.y) > - dots.d_radius){
									ctx.beginPath();
									ctx.strokeStyle = averageColorStyles(i_dot, j_dot);
									ctx.moveTo(i_dot.x, i_dot.y);
									ctx.lineTo(j_dot.x, j_dot.y);
									ctx.stroke();
									ctx.closePath();
								}
							}				
						}
					}
				}

				//画线
				function drawDots() {
					for(i = 0; i < dots.num; i++){
						var dot = dots.array[i];
						dot.draw();
					}
				}

				function animateDots() {
					ctx.clearRect(0, 0, canvas.width, canvas.height);
					moveDots();
					connectDots();
					drawDots();

					requestAnimationFrame(animateDots);	
				}

				//鼠标移入
				document.getElementById('canvas').onmousemove = function(e){
					clearInterval(timer);
					mousePosition.x = e.pageX;
					mousePosition.y = e.pageY;
				};

				document.getElementById('canvas').onmouseleave = function(e){
					timer = setInterval(function(){
						mousePosition.x = canvas.width *Math.random();
						mousePosition.y = canvas.height *Math.random();
					},3000);

				};


				createDots();
				requestAnimationFrame(animateDots);	
			}
			// changeScreen();
			//浏览器窗口改变事件
			window.onresize = function(){
				canvas.width = window.innerWidth;
				canvas.height = window.innerHeight
				changeScreen();
			}
	</script>
</body>
</html>